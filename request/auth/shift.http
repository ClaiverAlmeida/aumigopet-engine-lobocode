@baseUrl = http://localhost:3000
@token = {{ platformAdminLogin.response.body.access_token }}
@adminToken = {{ adminLogin.response.body.access_token }}

@entity = shifts

### Login SYSTEM_ADMIN (necessÃ¡rio para acessar turno)
# @name platformAdminLogin
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
    # "login": "System Admin Claiver", 
    # "password": "SystemAdmin@Senha"
    #   "login": "hr.turno",
    #   "login": "admin.empresA",
      "login": "guard3.user",
    "password": "SystemAdmin123@Senha"
}

### Login ADMIN (para testes de mÃ©tricas/auditoria)
# @name adminLogin
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
    "login": "admin@user.com",
    "password": "SystemAdmin123@Senha"
}

### ========================================
### ğŸ“‹ POSTS - CRUD BÃSICO
### ========================================

### ğŸ“– Listar todas as turno (com paginaÃ§Ã£o)
GET {{baseUrl}}/{{entity}}?page=1&limit=20
Authorization: Bearer {{token}}

### ğŸ“– Listar todos os turnos em andamento
GET {{baseUrl}}/{{entity}}/in-progress
Authorization: Bearer {{token}}

### ğŸ“– Listar todas as turnos
GET {{baseUrl}}/{{entity}}/all
Authorization: Bearer {{token}}

### ğŸ“– Buscar turno especÃ­fica por ID 
GET {{baseUrl}}/{{entity}}/cme7upk7k0000lts43adbp56r
Authorization: Bearer {{token}}

### âœï¸ Criar nova turno 
POST {{baseUrl}}/{{entity}}/start-time
Content-Type: application/json
Authorization: Bearer {{token}}

{   
    "postId": "cme7t1mgk0001ltkdm6k8n11w", 
    "function": "PATROL",  
    "startTime": "2025-02-01T00:00:00.000Z"
}

### âœï¸ Iniciar intervalo de turno
PATCH {{baseUrl}}/{{entity}}/break-start-time/cme9c194g0001ltxw5dx0cogk
Content-Type: application/json
Authorization: Bearer {{token}}

{
    "breakStartTime": "2025-01-01T00:00:00.000Z"
}

### âœï¸ Finalizar intervalo de turno
PATCH {{baseUrl}}/{{entity}}/break-end-time/cme9boc8r0000ltxdcw6w2sid
Content-Type: application/json
Authorization: Bearer {{token}}

{
    "breakEndTime": "2025-01-01T00:00:00.000Z"
}
### âœï¸ Finalizar turno
PATCH {{baseUrl}}/{{entity}}/end-time/cme9ezvfg0000ltdc25pqb9u6
Content-Type: application/json
Authorization: Bearer {{token}}

{
    "endTime": "2025-01-01T00:00:00.000Z"
} 

### âŒ Deletar turno (soft delete)
DELETE {{baseUrl}}/{{entity}}/cme61gmki0000ltjlv2w2jf6f
Authorization: Bearer {{token}}

### â™»ï¸ Restaurar turno deletada
POST {{baseUrl}}/{{entity}}/cme61gmki0000ltjlv2w2jf6f/restore
Authorization: Bearer {{token}}

### ========================================
### ğŸ” COMPANIES - BUSCA ESPECIALIZADA
### ========================================

### ğŸ” Buscar turno por CNPJ
GET {{baseUrl}}/{{entity}}/search/cnpj/81.811.213/0001-03
Authorization: Bearer {{token}}

### ğŸ” Buscar turnos por nome
GET {{baseUrl}}/{{entity}}/search/name?name=TechCorp Ltda
Authorization: Bearer {{token}}

### ğŸ” Buscar turnos por nome (parcial)
GET {{baseUrl}}/{{entity}}/search/name?name=Tech
Authorization: Bearer {{token}}

### ========================================
### ğŸ“Š COMPANIES - AUDITORIA E MÃ‰TRICAS
### ========================================

### ğŸ“ˆ MÃ©tricas gerais de turnos
GET {{baseUrl}}/{{entity}}/metrics
Authorization: Bearer {{token}}

### ğŸ“ˆ MÃ©tricas com filtro de perÃ­odo
GET {{baseUrl}}/{{entity}}/metrics?startDate=2024-01-01&endDate=2024-12-31
Authorization: Bearer {{token}}

### ğŸ“ˆ MÃ©tricas por usuÃ¡rio especÃ­fico
GET {{baseUrl}}/{{entity}}/metrics?userId=user-uuid-123
Authorization: Bearer {{token}}

### ğŸ“ˆ MÃ©tricas por aÃ§Ã£o especÃ­fica
GET {{baseUrl}}/{{entity}}/metrics?action=create
Authorization: Bearer {{token}}

### ğŸ“ˆ MÃ©tricas com mÃºltiplos filtros
GET {{baseUrl}}/{{entity}}/metrics?startDate=2024-01-01&endDate=2024-12-31&action=create&userId=user-uuid-123
Authorization: Bearer {{token}}

### ğŸ“‹ Logs de auditoria bÃ¡sicos
GET {{baseUrl}}/{{entity}}/logs
Authorization: Bearer {{token}}

### ğŸ“‹ Logs com limite especÃ­fico
GET {{baseUrl}}/{{entity}}/logs?limit=50
Authorization: Bearer {{token}}

### ğŸ“‹ Logs por perÃ­odo
GET {{baseUrl}}/{{entity}}/logs?startDate=2024-01-01&endDate=2024-12-31
Authorization: Bearer {{token}}

### ğŸ“‹ Logs por usuÃ¡rio
GET {{baseUrl}}/{{entity}}/logs?userId=user-uuid-123
Authorization: Bearer {{token}}

### ğŸ“‹ Logs por aÃ§Ã£o
GET {{baseUrl}}/{{entity}}/logs?action=create
Authorization: Bearer {{token}}

### ğŸ“‹ Logs apenas de sucessos
GET {{baseUrl}}/{{entity}}/logs?success=true
Authorization: Bearer {{token}}

### ğŸ“‹ Logs apenas de falhas
GET {{baseUrl}}/{{entity}}/logs?success=false
Authorization: Bearer {{token}}

### ğŸ“‹ Logs com mÃºltiplos filtros
GET {{baseUrl}}/{{entity}}/logs?limit=100&startDate=2024-01-01&userId=user-uuid-123&action=create&success=true
Authorization: Bearer {{token}}

### âŒ Logs especÃ­ficos de falhas
GET {{baseUrl}}/{{entity}}/logs/failures
Authorization: Bearer {{token}}

### âŒ Logs de falhas com limite
GET {{baseUrl}}/{{entity}}/logs/failures?limit=25
Authorization: Bearer {{token}}

### âŒ Logs de falhas por perÃ­odo
GET {{baseUrl}}/{{entity}}/logs/failures?startDate=2024-01-01&endDate=2024-12-31
Authorization: Bearer {{token}}

### ğŸ“Š EstatÃ­sticas de uso da entidade
GET {{baseUrl}}/{{entity}}/analytics/usage
Authorization: Bearer {{token}}

### ğŸ“Š EstatÃ­sticas por perÃ­odo
GET {{baseUrl}}/{{entity}}/analytics/usage?startDate=2024-01-01&endDate=2024-12-31
Authorization: Bearer {{token}}

### ========================================
### ğŸ“¤ COMPANIES - EXPORTAÃ‡ÃƒO (SYSTEM_ADMIN ONLY)
### ========================================

### ğŸ“¤ Exportar logs em JSON
GET {{baseUrl}}/{{entity}}/export/logs?format=json
Authorization: Bearer {{token}}

### ğŸ“¤ Exportar logs em CSV
GET {{baseUrl}}/{{entity}}/export/logs?format=csv
Authorization: Bearer {{token}}

### ğŸ“¤ Exportar logs filtrados em CSV
GET {{baseUrl}}/{{entity}}/export/logs?format=csv&startDate=2024-01-01&endDate=2024-12-31
Authorization: Bearer {{token}}

### ğŸ“¤ Exportar apenas falhas em CSV
GET {{baseUrl}}/{{entity}}/export/logs?format=csv&success=false
Authorization: Bearer {{token}}

### ğŸ“¤ Exportar logs por usuÃ¡rio em JSON
GET {{baseUrl}}/{{entity}}/export/logs?format=json&userId=user-uuid-123
Authorization: Bearer {{token}}

### ğŸ“¤ Exportar logs por aÃ§Ã£o em CSV
GET {{baseUrl}}/{{entity}}/export/logs?format=csv&action=create
Authorization: Bearer {{token}}

### ğŸ“¤ Exportar logs com todos os filtros
GET {{baseUrl}}/{{entity}}/export/logs?format=csv&startDate=2024-01-01&endDate=2024-12-31&userId=user-uuid-123&action=create&success=true
Authorization: Bearer {{token}}

### ========================================
### ğŸ” TESTES DE PERMISSÃƒO - ADMIN (PODE ACESSAR MÃ‰TRICAS)
### ========================================

### âœ… ADMIN acessando mÃ©tricas (deve funcionar)
GET {{baseUrl}}/{{entity}}/metrics
Authorization: Bearer {{adminToken}}

### âœ… ADMIN acessando logs (deve funcionar)
GET {{baseUrl}}/{{entity}}/logs
Authorization: Bearer {{adminToken}}

### âœ… ADMIN acessando anÃ¡lises (deve funcionar)
GET {{baseUrl}}/{{entity}}/analytics/usage
Authorization: Bearer {{adminToken}}

### âŒ ADMIN tentando exportar (deve falhar - sÃ³ SYSTEM_ADMIN)
GET {{baseUrl}}/{{entity}}/export/logs?format=csv
Authorization: Bearer {{adminToken}}

### ========================================
### ğŸ” TESTES DE SEGURANÃ‡A - OUTROS ROLES
### ========================================

### Login HR (para teste de negaÃ§Ã£o)
# @name hrLogin
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
    "email": "hr@user.com",
    "password": "SystemAdmin123@Senha"
}

### âŒ HR tentando acessar mÃ©tricas (deve falhar)
GET {{baseUrl}}/{{entity}}/metrics
Authorization: Bearer {{hrLogin.response.body.access_token}}

### âŒ HR tentando acessar logs (deve falhar)
GET {{baseUrl}}/{{entity}}/logs
Authorization: Bearer {{hrLogin.response.body.access_token}}

### âŒ HR tentando exportar (deve falhar)
GET {{baseUrl}}/{{entity}}/export/logs
Authorization: Bearer {{hrLogin.response.body.access_token}}

### âœ… HR acessando busca (deve funcionar)
GET {{baseUrl}}/{{entity}}/search/name?name=TechCorp
Authorization: Bearer {{hrLogin.response.body.access_token}}

### ========================================
### ğŸ§ª TESTES DE VALIDAÃ‡ÃƒO E ERROS
### ========================================

### âŒ Buscar turno inexistente
GET {{baseUrl}}/{{entity}}/uuid-inexistente-123
Authorization: Bearer {{token}}

### âŒ Buscar por CNPJ inexistente
GET {{baseUrl}}/{{entity}}/search/cnpj/00000000000000
Authorization: Bearer {{token}}

### âŒ Buscar por nome sem parÃ¢metro (deve falhar)
GET {{baseUrl}}/{{entity}}/search/name
Authorization: Bearer {{token}}

### âŒ Criar turno com CNPJ invÃ¡lido
POST {{baseUrl}}/{{entity}}
Content-Type: application/json
Authorization: Bearer {{token}}

{
    "name": "Empresa Teste",
    "cnpj": "123456789", 
    "contactEmail": "teste@turno.com"
}

### âŒ Criar turno com CNPJ duplicado
POST {{baseUrl}}/{{entity}}
Content-Type: application/json
Authorization: Bearer {{token}}

{
    "name": "Outra Empresa",
    "cnpj": "81.811.213/0001-03", 
    "contactEmail": "outra@turno.com"
}

### âŒ Criar turno sem dados obrigatÃ³rios
POST {{baseUrl}}/{{entity}}
Content-Type: application/json
Authorization: Bearer {{token}}

{
    "website": "https://www.turno.com"
}

### âŒ Acessar sem token
GET {{baseUrl}}/{{entity}}

### âŒ Acessar com token invÃ¡lido
GET {{baseUrl}}/{{entity}}
Authorization: Bearer token-invalido-123

### ========================================
### ğŸ“Š TESTES DE FILTROS AVANÃ‡ADOS
### ========================================

### ğŸ“Š MÃ©tricas dos Ãºltimos 7 dias
GET {{baseUrl}}/{{entity}}/metrics?startDate=2024-01-15&endDate=2024-01-22
Authorization: Bearer {{token}}

### ğŸ“Š Logs dos Ãºltimos 30 dias
GET {{baseUrl}}/{{entity}}/logs?startDate=2024-01-01&endDate=2024-01-31&limit=200
Authorization: Bearer {{token}}

### ğŸ“Š AnÃ¡lise de uso mensal
GET {{baseUrl}}/{{entity}}/analytics/usage?startDate=2024-01-01&endDate=2024-01-31
Authorization: Bearer {{token}}

### ğŸ“Š ExportaÃ§Ã£o trimestral
GET {{baseUrl}}/{{entity}}/export/logs?format=csv&startDate=2024-01-01&endDate=2024-03-31
Authorization: Bearer {{token}}

### ========================================
### ğŸ¯ TESTES DE CENÃRIOS REAIS
### ========================================

### ğŸ¯ CenÃ¡rio 1: Administrador verificando atividade suspeita
# 1. Ver mÃ©tricas gerais
GET {{baseUrl}}/{{entity}}/metrics
Authorization: Bearer {{token}}

# 2. Ver logs de falhas
GET {{baseUrl}}/{{entity}}/logs/failures?limit=50
Authorization: Bearer {{token}}

# 3. Exportar para anÃ¡lise
GET {{baseUrl}}/{{entity}}/export/logs?format=csv&success=false&startDate=2024-01-01
Authorization: Bearer {{token}}

### ğŸ¯ CenÃ¡rio 2: Auditoria mensal
# 1. EstatÃ­sticas do mÃªs
GET {{baseUrl}}/{{entity}}/analytics/usage?startDate=2024-01-01&endDate=2024-01-31
Authorization: Bearer {{token}}

# 2. RelatÃ³rio completo
GET {{baseUrl}}/{{entity}}/export/logs?format=csv&startDate=2024-01-01&endDate=2024-01-31
Authorization: Bearer {{token}}

### ğŸ¯ CenÃ¡rio 3: Busca operacional
# 1. Buscar turno por CNPJ
GET {{baseUrl}}/{{entity}}/search/cnpj/81.811.213/0001-03
Authorization: Bearer {{token}}

# 2. Ver detalhes
GET {{baseUrl}}/{{entity}}/cme607g2l0000ltmhx27ay7zm
Authorization: Bearer {{token}}

# 3. Atualizar dados
PATCH {{baseUrl}}/{{entity}}/cme607g2l0000ltmhx27ay7zm
Content-Type: application/json
Authorization: Bearer {{token}}

{
    "contactPhone": "(11) 99999-0000"
}