// ===============================================
// üéØ PRISMA SCHEMA - INFRASEG ENGINE
// ===============================================
// Schema consolidado para sistema multi-tenant
// Seguindo regras do projeto: entidades em ingl√™s
// ===============================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ===============================================
// üéØ ENUMS CENTRALIZADOS
// ===============================================
// Todos os enums do sistema em um local centralizado
// Seguindo regras do projeto: entidades em ingl√™s
// ===============================================

// ===============================================
// üë• ROLES E USU√ÅRIOS
// ===============================================

enum Roles {
  SYSTEM_ADMIN // Admin global do sistema
  ADMIN // Admin da empresa
  HR // Recursos humanos
  SUPERVISOR // Supervisor
  GUARD // Vigilante de seguran√ßa
  POST_SUPERVISOR // Supervisor de posto
  POST_RESIDENT // Morador/residente

  // tempor√°rio, irei remover
  EDITOR
  WRITER
  READER
}

enum UserStatus {
  ACTIVE // Ativo - funcion√°rio em atividade normal
  INACTIVE // Inativo - funcion√°rio desligado
  PENDING // Pendente - aguardando aprova√ß√£o/documenta√ß√£o
  ON_LEAVE // Em f√©rias - funcion√°rio em per√≠odo de f√©rias
  SICK_LEAVE // Licen√ßa m√©dica - funcion√°rio em licen√ßa por sa√∫de
  SUSPENDED // Suspenso - funcion√°rio temporariamente suspenso
  TERMINATED // Demitido - funcion√°rio demitido/desligado
}

enum PermissionType {
  DOORMAN // Porteiro
  SUPPORT // Apoio  
  PATROL // Rota
}

// ===============================================
// ‚è∞ TURNOS E OPERA√á√ïES
// ===============================================

enum WorkShift {
  DAY // Diurno
  NIGHT // Noturno 
}

enum ShiftFunction {
  PATROL // Rota
  SUPPORT // Apoio
  DOORMAN // Portaria
}

enum ShiftStatus {
  PENDING // Pendente
  IN_PROGRESS // Em andamento
  BREAK // Intervalo
  COMPLETED // Conclu√≠do
  ABSENCE // Aus√™ncia
}

// ===============================================
// üö∂ RONDAS E CHECKPOINTS
// ===============================================

enum PatrolStatus {
  IDLE // Aguardando
  STARTED // Em andamento
  PAUSED // Pausada
  COMPLETED // Conclu√≠da
  CANCELLED // Cancelada
}

enum CheckpointStatus {
  PENDING // Pendente
  COMPLETED // Conclu√≠do
  SKIPPED // Pulado
}

enum CheckpointCategory {
  SECURITY // Seguran√ßa
  MAINTENANCE // Manuten√ß√£o
  INSPECTION // Inspe√ß√£o
  GENERAL // Geral
}

// ===============================================
// üìù OCORR√äNCIAS E RELAT√ìRIOS
// ===============================================

enum ReportStatus {
  PENDING // Pendente
  IN_PROGRESS // Em andamento
  RESOLVED // Resolvida
  CANCELLED // Cancelada
}

// ===============================================
// üöó VE√çCULOS E CHECKLISTS
// ===============================================

enum VehicleType {
  CAR
  MOTORCYCLE
}

enum FuelLevel {
  FULL // 1 - Tanque cheio
  HALF // 0.5 - Meio tanque  
  EMPTY // 0 - Vazio
}

enum VehicleStatus {
  ACTIVE // Ativo
  MAINTENANCE // Em manuten√ß√£o
  INACTIVE // Inativo
}

enum VehicleChecklistStatus {
  PENDING // Pendente
  COMPLETED // Conclu√≠do
}

enum ChecklistItemStatus {
  OK // OK
  NOK // N√£o OK
  NOT_CHECKED // N√£o verificado
}

// ===============================================
// üè¢ EMPRESAS E MULTI-TENANCY
// ===============================================
// Modelo de empresas para sistema multi-tenant
// Cada empresa √© um tenant isolado
// ===============================================

model Company {
  id           String  @id @default(cuid())
  name         String
  cnpj         String  @unique
  website      String?
  address      String?
  country      String?
  contactName  String?
  contactEmail String?
  contactPhone String?

  // ===============================================
  // üîó RELACIONAMENTOS PRINCIPAIS
  // ===============================================

  // Usu√°rios da empresa
  users User[]

  // Postos de seguran√ßa
  posts Post[]

  // ===============================================
  // üîó RELACIONAMENTOS OPERACIONAIS
  // ===============================================

  // Opera√ß√µes principais
  shifts      Shift[]      @relation("CompanyShifts")
  patrols     Patrol[]     @relation("CompanyPatrols")
  occurrences Occurrence[] @relation("CompanyOccurrences")

  // Checkpoints da empresa
  checkpoints Checkpoint[] @relation("CompanyCheckpoints")

  // ===============================================
  // üîó RELACIONAMENTOS DE VE√çCULOS
  // ===============================================

  // Frota da empresa
  vehicles            Vehicle[]             @relation("CompanyVehicles")
  vehicleChecklists   VehicleChecklist[]    @relation("CompanyVehicleChecklists")
  MotorcycleChecklist MotorcycleChecklist[] @relation("CompanyMotorcycleChecklists")
  supplies            Supply[]              @relation("CompanySupplies")
  motorizedServices   MotorizedService[]    @relation("CompanyMotorizedServices")
  OccurrenceDispatch  OccurrenceDispatch[]  @relation("CompanyOccurrencesDispatches")
  DoormanChecklist    DoormanChecklist[]    @relation("CompanyDoormanChecklists")
  // ===============================================
  // üîó RELACIONAMENTOS DE EVENTOS
  // ===============================================

  // Logs e eventos
  eventLogs   EventLog[]   @relation("CompanyEventLogs")
  panicEvents PanicEvent[] @relation("CompanyPanicEvents")

  // Arquivos da empresa
  files File[] @relation("CompanyFiles")

  // ===============================================
  // üìä AUDITORIA E √çNDICES
  // ===============================================
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  deletedAt           DateTime? 

  @@index([cnpj])
  @@index([name])
  @@index([deletedAt])
}

// ===============================================
// üë• USU√ÅRIOS E PERMISS√ïES
// ===============================================
// Modelo de usu√°rios do sistema multi-tenant
// Seguindo regras: entidades em ingl√™s, relacionamentos claros
// ===============================================

model User {
  id             String     @id @default(cuid())
  name           String
  email          String     @unique
  login          String     @unique
  password       String
  role           Roles
  company        Company?   @relation(fields: [companyId], references: [id])
  companyId      String?
  profilePicture String?
  registration   String?    @unique
  status         UserStatus @default(ACTIVE)

  // Campos de auditoria
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  // Campos de valida√ß√£o
  rg      String? @unique
  cpf     String? @unique
  phone   String?
  address String?

  // ===============================================
  // üîó RELACIONAMENTOS OPERACIONAIS
  // ===============================================

  // Permiss√µes (apenas para Guards)
  permissions Permission[]

  // Opera√ß√µes principais
  shifts  Shift[]  @relation("UserShifts")
  patrols Patrol[] @relation("UserPatrols")

  // Relacionamentos com postos
  userPosts UserPost[] // Para POST_SUPERVISOR e POST_RESIDENT

  // Ve√≠culos e opera√ß√µes
  supplies                    Supply[]              @relation("UserSupplies")
  occurrences                 Occurrence[]          @relation("UserOccurrences")
  vehicleChecklists           VehicleChecklist[]    @relation("UserVehicleChecklists")
  MotorcycleChecklist         MotorcycleChecklist[] @relation("UserMotorcycleChecklists")
  motorizedServices           MotorizedService[]    @relation("UserMotorizedServices")
  supervisorMotorizedServices MotorizedService[]    @relation("SupervisorMotorizedServices")
  OccurrenceDispatch          OccurrenceDispatch[]  @relation("UserOccurrencesDispatches")
  OccurrenceDispatchGuard     OccurrenceDispatch[]  @relation("GuardOccurrencesDispatches")
  DoormanChecklist            DoormanChecklist[]    @relation("UserDoormanChecklists")

  // Aprova√ß√µes e valida√ß√µes
  supplyReviewedBy              Supply[]              @relation("SupplyReviewedBy")
  occurrenceReviewedBy          Occurrence[]          @relation("OccurrenceReviewedBy")
  occurrenceDispatchReviewedBy  OccurrenceDispatch[]  @relation("OccurrencesDispatchesReviewedBy")
  vehicleChecklistReviewedBy    VehicleChecklist[]    @relation("VehicleChecklistReviewedBy")
  motorcycleChecklistReviewedBy MotorcycleChecklist[] @relation("MotorcycleChecklistReviewedBy")
  motorizedServiceReviewedBy    MotorizedService[]    @relation("MotorizedServiceReviewedBy")
  DoormanChecklistReviewedBy    DoormanChecklist[]    @relation("DoormanChecklistReviewedBy")

  // Eventos e logs
  eventLogs   EventLog[]   @relation("UserEventLogs")
  panicEvents PanicEvent[] @relation("UserPanicEvents")

  // Arquivos enviados pelo usu√°rio
  files File[] @relation("UserFiles")

  // ===============================================
  // üìä √çNDICES PARA PERFORMANCE
  // ===============================================
  @@index([companyId])
  @@index([email])
  @@index([cpf])
  @@index([status])
  @@index([deletedAt])
  @@index([role])
  @@index([createdAt])
}

// ===============================================
// üè¢ RELACIONAMENTO USU√ÅRIO-POSTO
// ===============================================
// Tabela para roles espec√≠ficos em postos
// POST_SUPERVISOR e POST_RESIDENT

model UserPost {
  id        String   @id @default(cuid())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  postId    String
  role      Roles // POST_SUPERVISOR ou POST_RESIDENT
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Garantir que um usu√°rio s√≥ pode ter um papel espec√≠fico por post
  @@unique([userId, postId, role])
  @@index([userId])
  @@index([postId])
  @@index([role])
}

// ===============================================
// üîê PERMISS√ïES DE USU√ÅRIOS
// ===============================================
// Sistema de permiss√µes granulares

model Permission {
  id             String         @id @default(cuid())
  user           User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId         String
  permissionType PermissionType // DOORMAN, SUPPORT, PATROL para Vigilantes
  granted        Boolean        @default(true)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt

  @@unique([userId, permissionType])
  @@index([userId])
  @@index([permissionType])
}

// ===============================================
// üè¢ POSTOS DE SEGURAN√áA
// ===============================================
// Modelo de postos/pontos de seguran√ßa
// Relacionados a empresas (multi-tenant)
// ===============================================

model Post {
  id        String  @id @default(cuid())
  name      String
  address   String?
  latitude  Float? // Coordenadas GPS do posto
  longitude Float? // Coordenadas GPS do posto

  // Relacionamento com empresa (multi-tenant)
  company   Company @relation(fields: [companyId], references: [id])
  companyId String

  // ===============================================
  // üîó RELACIONAMENTOS OPERACIONAIS
  // ===============================================

  // Opera√ß√µes principais
  shifts              Shift[]               @relation("PostShifts")
  patrols             Patrol[]              @relation("PostPatrols")
  occurrences         Occurrence[]          @relation("PostOccurrences")
  OccurrenceDispatch  OccurrenceDispatch[]  @relation("PostOccurrencesDispatches")
  motorizedServices   MotorizedService[]    @relation("PostMotorizedServices")
  Supply              Supply[]              @relation("PostSupplies")
  vehicleChecklists   VehicleChecklist[]    @relation("PostVehicleChecklists")
  MotorcycleChecklist MotorcycleChecklist[] @relation("PostMotorcycleChecklists")
  DoormanChecklist    DoormanChecklist[]    @relation("PostDoormanChecklists")
  // Checkpoints do posto
  checkpoints         Checkpoint[]          @relation("PostCheckpoints")

  // ===============================================
  // üîó RELACIONAMENTOS DE USU√ÅRIOS
  // ===============================================

  // Usu√°rios com roles espec√≠ficos no posto
  userPosts UserPost[] // POST_SUPERVISOR e POST_RESIDENT

  // ===============================================
  // üîó RELACIONAMENTOS DE EVENTOS
  // ===============================================

  // Eventos do posto
  eventLogs   EventLog[]   @relation("PostEventLogs")
  panicEvents PanicEvent[] @relation("PostPanicEvents")

  // ===============================================
  // üìä AUDITORIA E √çNDICES
  // ===============================================
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  deletedAt           DateTime? 

  @@index([companyId])
  @@index([name])
  @@index([deletedAt])
}

// ===============================================
// ‚è∞ TURNOS DE TRABALHO
// ===============================================
// Sistema de controle de turnos integrado ao frontend
// Regras: 12h com toler√¢ncia de 5min, intervalos obrigat√≥rios
// ===============================================

model Shift {
  id String @id @default(cuid())

  // ===============================================
  // üìã DADOS PRINCIPAIS
  // ===============================================

  // Hor√°rios do turno
  startTime      DateTime // In√≠cio do turno
  breakStartTime DateTime? // In√≠cio do intervalo
  breakEndTime   DateTime? // Fim do intervalo
  endTime        DateTime? // Fim do turno

  // Configura√ß√µes do turno
  function ShiftFunction // PATROL, SUPPORT, DOORMAN
  status   ShiftStatus   @default(PENDING)

  // ===============================================
  // üîó RELACIONAMENTOS PRINCIPAIS
  // ===============================================

  // Multi-tenancy e hierarquia
  company   Company @relation("CompanyShifts", fields: [companyId], references: [id])
  companyId String

  post   Post   @relation("PostShifts", fields: [postId], references: [id])
  postId String

  user   User   @relation("UserShifts", fields: [userId], references: [id])
  userId String

  // ===============================================
  // üîó RELACIONAMENTOS OPERACIONAIS
  // ===============================================

  // Rondas realizadas durante o turno
  patrols Patrol[] @relation("ShiftPatrols")

  // Ocorr√™ncias registradas no turno
  occurrences         Occurrence[]          @relation("ShiftOccurrences")
  OccurrenceDispatch  OccurrenceDispatch[]  @relation("ShiftOccurrencesDispatches")
  DoormanChecklist    DoormanChecklist[]    @relation("ShiftDoormanChecklists")
  VehicleChecklist    VehicleChecklist[]    @relation("ShiftVehicleChecklists")
  MotorcycleChecklist MotorcycleChecklist[] @relation("ShiftMotorcycleChecklists")
  MotorizedService    MotorizedService[]    @relation("ShiftMotorizedServices")
  Supply              Supply[]              @relation("ShiftSupplies")

  // ===============================================
  // üìä AUDITORIA E CONTROLE
  // ===============================================

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  createdBy String? // ID do usu√°rio que criou
  updatedBy String? // ID do usu√°rio que atualizou

  // ===============================================
  // üìä √çNDICES PARA PERFORMANCE
  // ===============================================   

  @@index([companyId])
  @@index([postId])
  @@index([userId])
  @@index([status])
  @@index([function])
  @@index([startTime])
  @@index([deletedAt])
  @@index([createdAt])
  // √çndice composto para buscar turno ativo de um usu√°rio
  @@index([userId, status, startTime])
  // √çndice para turnos por per√≠odo
  @@index([companyId, startTime, endTime])
}

// ===============================================
// üö∂ RONDAS DE SEGURAN√áA
// ===============================================
// Sistema de rondas com GPS e checkpoints obrigat√≥rios
// Integrado ao frontend: PatrolPage
// ===============================================

model Patrol {
  id String @id @default(cuid())

  // ===============================================
  // üìã DADOS PRINCIPAIS
  // ===============================================

  // Hor√°rios da ronda
  startTime DateTime // In√≠cio da ronda
  endTime   DateTime? // Fim da ronda
  pausedAt  DateTime? // Momento da pausa
  resumedAt DateTime? // Momento da retomada

  // Status e configura√ß√µes
  status      PatrolStatus @default(IDLE)
  description String? // Descri√ß√£o/observa√ß√µes

  // Aprova√ß√µes e valida√ß√µes
  supervisorApproval Boolean? // Necessita aprova√ß√£o?
  requiresValidation Boolean  @default(false)

  // ===============================================
  // üîó RELACIONAMENTOS PRINCIPAIS
  // ===============================================

  // Multi-tenancy e hierarquia
  company   Company @relation("CompanyPatrols", fields: [companyId], references: [id])
  companyId String

  post   Post   @relation("PostPatrols", fields: [postId], references: [id])
  postId String

  user   User   @relation("UserPatrols", fields: [userId], references: [id])
  userId String

  // Relacionamento com turno
  shift   Shift?  @relation("ShiftPatrols", fields: [shiftId], references: [id])
  shiftId String?

  // ===============================================
  // üîó RELACIONAMENTOS OPERACIONAIS
  // ===============================================

  // Checkpoints verificados na ronda
  checkpoints PatrolCheckpoint[] @relation("PatrolPatrolCheckpoints")

  // ===============================================
  // üìä CAMPOS CALCULADOS E M√âTRICAS
  // ===============================================

  // Dura√ß√£o total da ronda (em minutos)
  totalDuration Int? // Calculado automaticamente

  // Dura√ß√£o das pausas (em minutos)
  pauseDuration Int? // Calculado automaticamente

  // M√©tricas de completude
  totalCheckpoints     Int    @default(0) // Total de checkpoints
  completedCheckpoints Int    @default(0) // Checkpoints conclu√≠dos
  skippedCheckpoints   Int    @default(0) // Checkpoints pulados
  completionRate       Float? // Taxa de conclus√£o (%)

  // Coordenadas de in√≠cio e fim
  startLatitude  Float? // GPS in√≠cio
  startLongitude Float? // GPS in√≠cio
  endLatitude    Float? // GPS fim
  endLongitude   Float? // GPS fim

  // ===============================================
  // üìä AUDITORIA E CONTROLE
  // ===============================================

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  createdBy String? // ID do usu√°rio que criou
  updatedBy String? // ID do usu√°rio que atualizou

  // Aprova√ß√µes e valida√ß√µes
  approvedBy      String? // ID do supervisor que aprovou
  approvedAt      DateTime? // Data/hora da aprova√ß√£o
  rejectedBy      String? // ID de quem rejeitou
  rejectedAt      DateTime? // Data/hora da rejei√ß√£o
  rejectionReason String? // Motivo da rejei√ß√£o

  // ===============================================
  // üìä √çNDICES PARA PERFORMANCE
  // ===============================================

  @@index([companyId])
  @@index([postId])
  @@index([userId])
  @@index([shiftId])
  @@index([status])
  @@index([startTime])
  @@index([deletedAt])
  @@index([createdAt])
  // √çndice para rondas ativas
  @@index([userId, status, startTime])
  // √çndice para rondas por per√≠odo e posto
  @@index([companyId, postId, startTime, endTime])
}

// ===============================================
// üìç CHECKPOINTS DOS POSTOS
// ===============================================
// Pontos de verifica√ß√£o para rondas

model Checkpoint {
  id          String             @id @default(cuid())
  name        String
  description String?
  latitude    Float // GPS obrigat√≥rio
  longitude   Float // GPS obrigat√≥rio
  required    Boolean            @default(false) // Checkpoint obrigat√≥rio?
  category    CheckpointCategory // Tipo de checkpoint
  order       Int? // Ordem na sequ√™ncia de ronda

  // Tempo estimado para verifica√ß√£o (em minutos)
  estimatedDuration Int? @default(5)

  // Status do checkpoint
  isActive Boolean @default(true)

  // ===============================================
  // üîó RELACIONAMENTOS
  // ===============================================

  // Relacionamento multi-tenant
  company   Company @relation("CompanyCheckpoints", fields: [companyId], references: [id])
  companyId String

  // Relacionamento com posto
  post   Post   @relation("PostCheckpoints", fields: [postId], references: [id])
  postId String

  // Verifica√ß√µes em rondas
  patrolCheckpoints PatrolCheckpoint[] @relation("CheckpointPatrolCheckpoints")

  // ===============================================
  // üìä AUDITORIA E √çNDICES
  // ===============================================
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  createdBy String?
  updatedBy String?

  @@index([companyId])
  @@index([postId])
  @@index([category])
  @@index([required])
  @@index([isActive])
  @@index([deletedAt])
}

// ===============================================
// üìç VERIFICA√á√ïES DE CHECKPOINTS
// ===============================================
// Registro de cada checkpoint verificado na ronda

model PatrolCheckpoint {
  id String @id @default(cuid())

  // ===============================================
  // üìã DADOS PRINCIPAIS
  // ===============================================

  // Hor√°rio da verifica√ß√£o
  completedAt DateTime? // Quando foi verificado
  startedAt   DateTime? // Quando come√ßou a verifica√ß√£o

  // Status da verifica√ß√£o
  status CheckpointStatus @default(PENDING)

  // Coordenadas GPS da verifica√ß√£o
  latitude  Float? // GPS atual
  longitude Float? // GPS atual
  accuracy  Float? // Precis√£o do GPS (metros)

  // Observa√ß√µes e notas
  notes  String? // Observa√ß√µes do guarda
  issues String? // Problemas identificados

  // ===============================================
  // üîó RELACIONAMENTOS
  // ===============================================

  // Relacionamento com ronda
  patrol   Patrol @relation("PatrolPatrolCheckpoints", fields: [patrolId], references: [id], onDelete: Cascade)
  patrolId String

  // Relacionamento com checkpoint
  checkpoint   Checkpoint @relation("CheckpointPatrolCheckpoints", fields: [checkpointId], references: [id])
  checkpointId String

  // ===============================================
  // üìä DADOS T√âCNICOS
  // ===============================================

  // Dist√¢ncia do checkpoint original (metros)
  distanceFromOriginal Float? // Calculado automaticamente

  // Tempo gasto neste checkpoint (minutos)
  timeSpent Int? // Calculado automaticamente

  // Sequ√™ncia na ronda (ordem de verifica√ß√£o)
  sequence Int? // Ordem de execu√ß√£o

  // ===============================================
  // üìä AUDITORIA
  // ===============================================

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ===============================================
  // üìä √çNDICES PARA PERFORMANCE
  // ===============================================

  @@index([patrolId])
  @@index([checkpointId])
  @@index([status])
  @@index([completedAt])
  @@index([sequence])
  // √çndice para buscar checkpoints por ronda e status
  @@index([patrolId, status, completedAt])
}

// ===============================================
// üìù OCORR√äNCIAS E RELAT√ìRIOS
// ===============================================
// Sistema de relat√≥rios de ocorr√™ncias
// Integrado ao frontend: OccurrenceReportPage
// Numera√ß√£o autom√°tica com reset di√°rio
// ===============================================

model Occurrence {
  id String @id @default(cuid())

  // ===============================================
  // üìã DADOS PRINCIPAIS (CONFORME FRONTEND)
  // ===============================================

  // Numera√ß√£o autom√°tica (reset di√°rio √†s 00:00)
  talaoNumber Int @default(autoincrement()) // Formato: "001", "002", etc.

  // Data e hor√°rio
  date DateTime // Data da ocorr√™ncia
  time String // Hora da ocorr√™ncia (HH:MM)

  // Dados do solicitante/envolvidos
  applicant String // Solicitante
  user      User   @relation("UserOccurrences", fields: [userId], references: [id])
  userId    String
  userName  String // Nome do usu√°rio
  rg        String // RG do usu√°rio

  // Localiza√ß√£o
  post        Post   @relation("PostOccurrences", fields: [postId], references: [id])
  postId      String
  postName    String // Nome do posto
  postAddress String // Endere√ßo do posto

  // Pessoas envolvidas (opcional)
  peopleInvolved String? // Pessoas envolvidas

  // Descri√ß√£o detalhada
  description String // Descri√ß√£o da ocorr√™ncia

  // Status do atendimento
  status ReportStatus @default(PENDING)

  // ===============================================
  // üîó RELACIONAMENTOS PRINCIPAIS
  // ===============================================

  // Multi-tenancy e hierarquia
  company   Company @relation("CompanyOccurrences", fields: [companyId], references: [id])
  companyId String

  // Relacionamento com turno (opcional)
  shift   Shift?  @relation("ShiftOccurrences", fields: [shiftId], references: [id])
  shiftId String?

  // ===============================================
  // üìä AUDITORIA E CONTROLE
  // ===============================================

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  createdBy String? // ID do usu√°rio que criou
  updatedBy String? // ID do usu√°rio que atualizou

  // Aprova√ß√µes e valida√ß√µes
  supervisorReview Boolean? // Revis√£o do supervisor
  reviewedById     String? // ID do supervisor que revisou
  reviewedBy       User?     @relation("OccurrenceReviewedBy", fields: [reviewedById], references: [id])
  reviewedAt       DateTime? // Data/hora da revis√£o
  reviewNotes      String? // Notas da revis√£o

  // ===============================================
  // üìä √çNDICES PARA PERFORMANCE
  // ===============================================

  @@index([companyId])
  @@index([postId])
  @@index([userId])
  @@index([shiftId])
  @@index([status])
  @@index([date])
  @@index([talaoNumber])
  @@index([deletedAt])
  @@index([createdAt])
}

model OccurrenceDispatch {
  id String @id @default(cuid())

  // ===============================================
  // üìã DADOS PRINCIPAIS (CONFORME FRONTEND)
  // ===============================================

  // Numera√ß√£o autom√°tica (reset di√°rio √†s 00:00)
  talaoNumber Int @default(autoincrement()) // Formato: "001", "002", etc.

  // Data e hor√°rio
  date        DateTime // Data da ocorr√™ncia 
  timeInitial String // Data e hora da solicita√ß√£o
  arrivalTime String? // Data e hora da chegada
  timeFinal   String? // Data e hora do t√©rmino

  // Dados do solicitante/envolvidos
  user     User    @relation("UserOccurrencesDispatches", fields: [userId], references: [id])
  userId   String
  userName String // Nome do usu√°rio 
  guard    User?   @relation("GuardOccurrencesDispatches", fields: [guardId], references: [id])
  guardId  String? // Vigilante

  // Localiza√ß√£o
  post              Post   @relation("PostOccurrencesDispatches", fields: [postId], references: [id])
  postId            String
  postName          String // Nome do posto
  occurrenceAddress String // Endere√ßo da ocorr√™ncia

  // Status do atendimento
  status ReportStatus @default(PENDING)

  // ===============================================
  // üîó RELACIONAMENTOS PRINCIPAIS
  // ===============================================

  // Multi-tenancy e hierarquia
  company   Company @relation("CompanyOccurrencesDispatches", fields: [companyId], references: [id])
  companyId String

  // Relacionamento com turno (opcional)
  shift   Shift?  @relation("ShiftOccurrencesDispatches", fields: [shiftId], references: [id])
  shiftId String?

  // ===============================================
  // üìä AUDITORIA E CONTROLE
  // ===============================================

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  createdBy String? // ID do usu√°rio que criou
  updatedBy String? // ID do usu√°rio que atualizou

  // Aprova√ß√µes e valida√ß√µes
  supervisorReview Boolean? // Revis√£o do supervisor
  reviewedById     String? // ID do supervisor que revisou
  reviewedBy       User?     @relation("OccurrencesDispatchesReviewedBy", fields: [reviewedById], references: [id])
  reviewedAt       DateTime? // Data/hora da revis√£o
  reviewNotes      String? // Notas da revis√£o

  // ===============================================
  // üìä √çNDICES PARA PERFORMANCE
  // ===============================================

  @@index([companyId])
  @@index([postId])
  @@index([userId])
  @@index([shiftId])
  @@index([status])
  @@index([date])
  @@index([talaoNumber])
  @@index([deletedAt])
  @@index([createdAt])
}

// ===============================================
// üöó VE√çCULOS DA FROTA
// ===============================================
// Gest√£o de ve√≠culos para empresas de seguran√ßa
// Integrado ao frontend: VehicleChecklistPage
// ===============================================

model Vehicle {
  id String @id @default(cuid())

  // ===============================================
  // üìã DADOS PRINCIPAIS DO VE√çCULO
  // ===============================================

  // Identifica√ß√£o b√°sica
  plate String      @unique // Placa √∫nica
  type  VehicleType // CAR, MOTORCYCLE
  model String // Modelo

  // Status do ve√≠culo
  status   VehicleStatus @default(ACTIVE)
  isActive Boolean       @default(true)

  // ===============================================
  // üîó RELACIONAMENTO MULTI-TENANT
  // ===============================================

  company   Company @relation("CompanyVehicles", fields: [companyId], references: [id])
  companyId String

  // ===============================================
  // üîó RELACIONAMENTOS OPERACIONAIS
  // ===============================================

  // Checklists de verifica√ß√£o 
  VehicleChecklist    VehicleChecklist[]    @relation("VehicleChecklists")
  MotorcycleChecklist MotorcycleChecklist[] @relation("MotorcycleChecklists")

  // Registros de abastecimento
  supplies Supply[] @relation("VehicleSupplies")

  // Relat√≥rios de servi√ßos motorizados
  motorizedServices MotorizedService[] @relation("VehicleMotorizedServices")

  // ===============================================
  // üìä DADOS DE MANUTEN√á√ÉO E CONTROLE
  // ===============================================

  // Quilometragem
  initialKm Int // valor inicial quando cadastrado o veiculo
  currentKm Int // valor atual do veiculo, atualizado automaticamente
  finalKm   Int? // valor final, nulo quando checklist em andamento 

  // Observa√ß√µes
  notes String? // Observa√ß√µes gerais

  // ===============================================
  // üìä AUDITORIA E CONTROLE
  // ===============================================

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  // ===============================================
  // üìä √çNDICES PARA PERFORMANCE
  // ===============================================   

  @@index([companyId])
  @@index([plate])
  @@index([status])
  @@index([isActive])
  @@index([deletedAt])
  @@index([createdAt])
  // √çndice para busca por empresa e status
  @@index([companyId, status, isActive])
}

// ===============================================
// ‚úÖ CHECKLISTS DE VE√çCULOS
// ===============================================
// Sistema de verifica√ß√£o de ve√≠culos
// Integrado ao frontend: VehicleChecklistPage
// ===============================================

model VehicleChecklist {
  id String @id @default(cuid())

  talaoNumber Int    @default(autoincrement()) // Formato: "001", "002", etc.
  // Usu√°rio respons√°vel
  user        User   @relation("UserVehicleChecklists", fields: [userId], references: [id])
  userId      String // motorista 
  userName    String // nome do motorista 

  // Status do atendimento
  status ReportStatus @default(PENDING)

  // Informa√ß√µes do ve√≠culo
  vehicleId String?
  vehicle   Vehicle? @relation("VehicleChecklists", fields: [vehicleId], references: [id], onDelete: Cascade)
  // Multi-tenancy
  company   Company  @relation("CompanyVehicleChecklists", fields: [companyId], references: [id])
  companyId String
  // Relacionamento com turno 
  shift     Shift    @relation("ShiftVehicleChecklists", fields: [shiftId], references: [id])
  shiftId   String
  // Posto onde ocorreu
  post      Post     @relation("PostVehicleChecklists", fields: [postId], references: [id])
  postId    String

  // Dados do checklist
  date               DateTime  @default(now())
  initialKm          Int
  finalKm            Int?
  generalObservation String?
  completedAt        DateTime?

  // ========================================
  // ITENS DO CHECKLIST - CAMPOS FIXOS
  // ========================================

  // √Ågua do Radiador
  aguaRadiadorFuncionando Boolean @default(false)
  aguaRadiadorAmassado    Boolean @default(false)
  aguaRadiadorArranhado   Boolean @default(false)
  aguaRadiadorObservacao  String?

  // √Ågua Reservat√≥rio Parabrisa
  aguaReservatorioFuncionando Boolean @default(false)
  aguaReservatorioAmassado    Boolean @default(false)
  aguaReservatorioArranhado   Boolean @default(false)
  aguaReservatorioObservacao  String?

  // √ìleo Motor
  oleoMotorFuncionando Boolean @default(false)
  oleoMotorAmassado    Boolean @default(false)
  oleoMotorArranhado   Boolean @default(false)
  oleoMotorObservacao  String?

  // √ìleo Freio
  oleoFreioFuncionando Boolean @default(false)
  oleoFreioAmassado    Boolean @default(false)
  oleoFreioArranhado   Boolean @default(false)
  oleoFreioObservacao  String?

  // Lanterna Dianteira Direita
  lanternaDianteiraDireitaFuncionando Boolean @default(false)
  lanternaDianteiraDireitaAmassado    Boolean @default(false)
  lanternaDianteiraDireitaArranhado   Boolean @default(false)
  lanternaDianteiraDireitaObservacao  String?

  // Lanterna Dianteira Esquerda
  lanternaDianteiraEsquerdaFuncionando Boolean @default(false)
  lanternaDianteiraEsquerdaAmassado    Boolean @default(false)
  lanternaDianteiraEsquerdaArranhado   Boolean @default(false)
  lanternaDianteiraEsquerdaObservacao  String?

  // Farol Baixo Direita
  farolBaixoDireitaFuncionando Boolean @default(false)
  farolBaixoDireitaAmassado    Boolean @default(false)
  farolBaixoDireitaArranhado   Boolean @default(false)
  farolBaixoDireitaObservacao  String?

  // Farol Baixo Esquerda
  farolBaixoEsquerdaFuncionando Boolean @default(false)
  farolBaixoEsquerdaAmassado    Boolean @default(false)
  farolBaixoEsquerdaArranhado   Boolean @default(false)
  farolBaixoEsquerdaObservacao  String?

  // Farol Alto Direita
  farolAltoDireitaFuncionando Boolean @default(false)
  farolAltoDireitaAmassado    Boolean @default(false)
  farolAltoDireitaArranhado   Boolean @default(false)
  farolAltoDireitaObservacao  String?

  // Farol Alto Esquerda
  farolAltoEsquerdaFuncionando Boolean @default(false)
  farolAltoEsquerdaAmassado    Boolean @default(false)
  farolAltoEsquerdaArranhado   Boolean @default(false)
  farolAltoEsquerdaObservacao  String?

  // Seta Dianteira Direita
  setaDianteiraDireitaFuncionando Boolean @default(false)
  setaDianteiraDireitaAmassado    Boolean @default(false)
  setaDianteiraDireitaArranhado   Boolean @default(false)
  setaDianteiraDireitaObservacao  String?

  // Seta Dianteira Esquerda
  setaDianteiraEsquerdaFuncionando Boolean @default(false)
  setaDianteiraEsquerdaAmassado    Boolean @default(false)
  setaDianteiraEsquerdaArranhado   Boolean @default(false)
  setaDianteiraEsquerdaObservacao  String?

  // Seta Traseira Direita
  setaTraseiraDireitaFuncionando Boolean @default(false)
  setaTraseiraDireitaAmassado    Boolean @default(false)
  setaTraseiraDireitaArranhado   Boolean @default(false)
  setaTraseiraDireitaObservacao  String?

  // Seta Traseira Esquerda
  setaTraseiraEsquerdaFuncionando Boolean @default(false)
  setaTraseiraEsquerdaAmassado    Boolean @default(false)
  setaTraseiraEsquerdaArranhado   Boolean @default(false)
  setaTraseiraEsquerdaObservacao  String?

  // Pisca Alerta
  piscaAlertaFuncionando Boolean @default(false)
  piscaAlertaAmassado    Boolean @default(false)
  piscaAlertaArranhado   Boolean @default(false)
  piscaAlertaObservacao  String?

  // Buzina
  buzinaFuncionando Boolean @default(false)
  buzinaAmassado    Boolean @default(false)
  buzinaArranhado   Boolean @default(false)
  buzinaObservacao  String?

  // Limpador de Parabrisa
  limpadorParabrisaFuncionando Boolean @default(false)
  limpadorParabrisaAmassado    Boolean @default(false)
  limpadorParabrisaArranhado   Boolean @default(false)
  limpadorParabrisaObservacao  String?

  // Esguicho d'√Ågua Parabrisa
  esguichoAguaParabrisaFuncionando Boolean @default(false)
  esguichoAguaParabrisaAmassado    Boolean @default(false)
  esguichoAguaParabrisaArranhado   Boolean @default(false)
  esguichoAguaParabrisaObservacao  String?

  // Lanterna Traseira Direita
  lanternaTraseiraDireitaFuncionando Boolean @default(false)
  lanternaTraseiraDireitaAmassado    Boolean @default(false)
  lanternaTraseiraDireitaArranhado   Boolean @default(false)
  lanternaTraseiraDireitaObservacao  String?

  // Lanterna Traseira Esquerda
  lanternaTraseiraEsquerdaFuncionando Boolean @default(false)
  lanternaTraseiraEsquerdaAmassado    Boolean @default(false)
  lanternaTraseiraEsquerdaArranhado   Boolean @default(false)
  lanternaTraseiraEsquerdaObservacao  String?

  // Luz de Freio
  luzFreioFuncionando Boolean @default(false)
  luzFreioAmassado    Boolean @default(false)
  luzFreioArranhado   Boolean @default(false)
  luzFreioObservacao  String?

  // Luz de R√©
  luzReFuncionando Boolean @default(false)
  luzReAmassado    Boolean @default(false)
  luzReArranhado   Boolean @default(false)
  luzReObservacao  String?

  // Pneus Dianteiro Direito
  pneusDianteiroFuncionando Boolean @default(false)
  pneusDianteiroAmassado    Boolean @default(false)
  pneusDianteiroArranhado   Boolean @default(false)
  pneusDianteiroObservacao  String?

  // Pneus Traseiro 
  pneusTraseiroFuncionando Boolean @default(false)
  pneusTraseiroAmassado    Boolean @default(false)
  pneusTraseiroArranhado   Boolean @default(false)
  pneusTraseiroObservacao  String?

  // Pneu Estepe
  estepeFuncionando Boolean @default(false)
  estepeAmassado    Boolean @default(false)
  estepeArranhado   Boolean @default(false)
  estepeObservacao  String?

  // Limpador de Vidro Traseiro
  limpadorVidroTraseiroFuncionando Boolean @default(false)
  limpadorVidroTraseiroAmassado    Boolean @default(false)
  limpadorVidroTraseiroArranhado   Boolean @default(false)
  limpadorVidroTraseiroObservacao  String?

  // Esguicho d'√Ågua Vidro Traseiro
  esguichoAguaVidroTraseiroFuncionando Boolean @default(false)
  esguichoAguaVidroTraseiroAmassado    Boolean @default(false)
  esguichoAguaVidroTraseiroArranhado   Boolean @default(false)
  esguichoAguaVidroTraseiroObservacao  String?

  // Porta Motorista
  portaMotoristaFuncionando Boolean @default(false)
  portaMotoristaAmassado    Boolean @default(false)
  portaMotoristaArranhado   Boolean @default(false)
  portaMotoristaObservacao  String?

  // Porta Passageiro Dianteiro
  portaPassageiroDianteiroFuncionando Boolean @default(false)
  portaPassageiroDianteiroAmassado    Boolean @default(false)
  portaPassageiroDianteiroArranhado   Boolean @default(false)
  portaPassageiroDianteiroObservacao  String?

  // Porta Traseira Esquerda
  portaTraseiraEsquerdaFuncionando Boolean @default(false)
  portaTraseiraEsquerdaAmassado    Boolean @default(false)
  portaTraseiraEsquerdaArranhado   Boolean @default(false)
  portaTraseiraEsquerdaObservacao  String?

  // Porta Traseira Direita
  portaTraseiraDireitaFuncionando Boolean @default(false)
  portaTraseiraDireitaAmassado    Boolean @default(false)
  portaTraseiraDireitaArranhado   Boolean @default(false)
  portaTraseiraDireitaObservacao  String?

  // Bot√µes do Painel Interno
  botoesPainelInternoFuncionando Boolean @default(false)
  botoesPainelInternoAmassado    Boolean @default(false)
  botoesPainelInternoArranhado   Boolean @default(false)
  botoesPainelInternoObservacao  String?

  // R√°dio FM
  radioFmFuncionando Boolean @default(false)
  radioFmAmassado    Boolean @default(false)
  radioFmArranhado   Boolean @default(false)
  radioFmObservacao  String?

  // Giriflex
  giriflexFuncionando Boolean @default(false)
  giriflexAmassado    Boolean @default(false)
  giriflexArranhado   Boolean @default(false)
  giriflexObservacao  String?

  // Chave de Roda
  chaveDeRodaFuncionando Boolean @default(false)
  chaveDeRodaAmassado    Boolean @default(false)
  chaveDeRodaArranhado   Boolean @default(false)
  chaveDeRodaObservacao  String?

  // Macaco
  macacoFuncionando Boolean @default(false)
  macacoAmassado    Boolean @default(false)
  macacoArranhado   Boolean @default(false)
  macacoObservacao  String?
  // ===============================================
  // üìä AUDITORIA E CONTROLE
  // ===============================================

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  createdBy String? // ID do usu√°rio que criou
  updatedBy String? // ID do usu√°rio que atualizou

  // Aprova√ß√µes e valida√ß√µes
  supervisorReview Boolean? // Revis√£o do supervisor
  reviewedById     String? // ID do supervisor que revisou
  reviewedBy       User?     @relation("VehicleChecklistReviewedBy", fields: [reviewedById], references: [id])
  reviewedAt       DateTime? // Data/hora da revis√£o
  reviewNotes      String? // Notas da revis√£o 

  // ========================================
  // √çNDICES PARA PERFORMANCE
  // ========================================
  // √çndices para consultas r√°pidas
  @@index([vehicleId])
  @@index([date])
  @@index([createdAt])
}

// ===============================================
// ‚úÖ CHECKLISTS DE MOTOS
// ===============================================
// Sistema de verifica√ß√£o de motos
// Integrado ao frontend: MotorcycleChecklistPage
// ===============================================
model MotorcycleChecklist {
  id String @id @default(cuid())

  talaoNumber Int    @default(autoincrement()) // Formato: "001", "002", etc.
  // Usu√°rio respons√°vel
  user        User   @relation("UserMotorcycleChecklists", fields: [userId], references: [id])
  userId      String // motorista 
  userName    String // nome do motorista 

  // Status do atendimento
  status ReportStatus @default(PENDING)

  // Informa√ß√µes da moto
  motorcycleId String?
  motorcycle   Vehicle? @relation("MotorcycleChecklists", fields: [motorcycleId], references: [id], onDelete: Cascade)

  // Multi-tenancy
  company   Company @relation("CompanyMotorcycleChecklists", fields: [companyId], references: [id])
  companyId String
  // Relacionamento com turno 
  shift     Shift   @relation("ShiftMotorcycleChecklists", fields: [shiftId], references: [id])
  shiftId   String
  // Posto onde ocorreu
  post      Post    @relation("PostMotorcycleChecklists", fields: [postId], references: [id])
  postId    String

  // Dados do checklist
  date               DateTime  @default(now())
  initialKm          Int
  finalKm            Int?
  generalObservation String?
  completedAt        DateTime?

  // ========================================
  // ITENS DO CHECKLIST - CAMPOS FIXOS (MOTO)
  // ========================================

  // √ìleo Motor
  oleoMotorFuncionando Boolean @default(false)
  oleoMotorDanificado  Boolean @default(false)
  oleoMotorObservacao  String?

  // Radiador / L√≠quido de arrefecimento
  radiadorFuncionando Boolean @default(false)
  radiadorDanificado  Boolean @default(false)
  radiadorObservacao  String?

  // Freios
  freioDianteiroFuncionando Boolean @default(false)
  freioDianteiroDanificado  Boolean @default(false)
  freioDianteiroObservacao  String?

  freioTraseiroFuncionando Boolean @default(false)
  freioTraseiroDanificado  Boolean @default(false)
  freioTraseiroObservacao  String?

  // Pneus
  pneuDianteiroFuncionando Boolean @default(false)
  pneuDianteiroDanificado  Boolean @default(false)
  pneuDianteiroObservacao  String?

  pneuTraseiroFuncionando Boolean @default(false)
  pneuTraseiroDanificado  Boolean @default(false)
  pneuTraseiroObservacao  String?

  // Ilumina√ß√£o
  farolBaixoFuncionando Boolean @default(false)
  farolBaixoDanificado  Boolean @default(false)
  farolBaixoObservacao  String?

  farolAltoFuncionando Boolean @default(false)
  farolAltoDanificado  Boolean @default(false)
  farolAltoObservacao  String?

  setaDireitaFuncionando Boolean @default(false)
  setaDireitaDanificado  Boolean @default(false)
  setaDireitaObservacao  String?

  setaEsquerdaFuncionando Boolean @default(false)
  setaEsquerdaDanificado  Boolean @default(false)
  setaEsquerdaObservacao  String?

  lanternaTraseiraFuncionando Boolean @default(false)
  lanternaTraseiraDanificado  Boolean @default(false)
  lanternaTraseiraObservacao  String?

  luzFreioFuncionando Boolean @default(false)
  luzFreioDanificado  Boolean @default(false)
  luzFreioObservacao  String?

  luzReFuncionando Boolean @default(false)
  luzReDanificado  Boolean @default(false)
  luzReObservacao  String?

  // Retrovisores
  retrovisorEsquerdoFuncionando Boolean @default(false)
  retrovisorEsquerdoDanificado  Boolean @default(false)
  retrovisorEsquerdoObservacao  String?

  retrovisorDireitoFuncionando Boolean @default(false)
  retrovisorDireitoDanificado  Boolean @default(false)
  retrovisorDireitoObservacao  String?

  // Buzina
  buzinaFuncionando Boolean @default(false)
  buzinaDanificado  Boolean @default(false)
  buzinaObservacao  String?

  // Corrente / Transmiss√£o
  correnteFuncionando Boolean @default(false)
  correnteDanificado  Boolean @default(false)
  correnteObservacao  String?

  // Guid√£o / Manetes
  manetesFuncionando Boolean @default(false)
  manetesDanificado  Boolean @default(false)
  manetesObservacao  String?

  guidonFuncionando Boolean @default(false)
  guidonDanificado  Boolean @default(false)
  guidonObservacao  String?

  // Ba√∫ / Suporte
  bauFuncionando Boolean @default(false)
  bauDanificado  Boolean @default(false)
  bauObservacao  String?

  suporteBauFuncionando Boolean @default(false)
  suporteBauDanificado  Boolean @default(false)
  suporteBauObservacao  String?

  // Capacete
  capaceteFuncionando Boolean @default(false)
  capaceteDanificado  Boolean @default(false)
  capaceteObservacao  String?

  // ===============================================
  // üìä AUDITORIA E CONTROLE
  // ===============================================

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  createdBy String? // ID do usu√°rio que criou
  updatedBy String? // ID do usu√°rio que atualizou

  // Aprova√ß√µes e valida√ß√µes
  supervisorReview Boolean?
  reviewedById     String?
  reviewedBy       User?     @relation("MotorcycleChecklistReviewedBy", fields: [reviewedById], references: [id])
  reviewedAt       DateTime?
  reviewNotes      String?
  vehicleId        String?

  // ========================================
  // √çNDICES PARA PERFORMANCE
  // ========================================
  @@index([motorcycleId])
  @@index([date])
  @@index([createdAt])
}

// ===============================================
// ‚õΩ ABASTECIMENTO DE VE√çCULOS
// ===============================================
// Sistema de controle de abastecimento
// Integrado ao frontend: SupplyRegistrationPage
// ===============================================

model Supply {
  id String @id @default(cuid())

  // ===============================================
  // üìã DADOS PRINCIPAIS (CONFORME FRONTEND)
  // ===============================================

  talaoNumber Int      @default(autoincrement()) // Formato: "001", "002", etc.
  date        DateTime // Data do abastecimento
  userName    String // Nome do usu√°rio

  // Quilometragem (conforme frontend)
  kmDeparture Int // Km de sa√≠da
  kmSupply    Int? // Km no abastecimento
  kmReturn    Int? // Km de retorno

  // Dados do combust√≠vel
  liters        Float? // Quantidade em litros
  price         Float? // Pre√ßo total pago
  pricePerLiter Float? // Pre√ßo por litro (calculado)
  // Status do atendimento
  status        ReportStatus @default(PENDING)

  // ===============================================
  // üîó RELACIONAMENTOS PRINCIPAIS
  // ===============================================

  // Multi-tenancy
  company   Company @relation("CompanySupplies", fields: [companyId], references: [id])
  companyId String

  // Ve√≠culo abastecido
  vehicle   Vehicle? @relation("VehicleSupplies", fields: [vehicleId], references: [id])
  vehicleId String?

  // Relacionamento com turno 
  shift   Shift  @relation("ShiftSupplies", fields: [shiftId], references: [id])
  shiftId String

  // Posto onde ocorreu
  post   Post   @relation("PostSupplies", fields: [postId], references: [id])
  postId String

  // Usu√°rio respons√°vel pelo registro
  user   User   @relation("UserSupplies", fields: [userId], references: [id])
  userId String

  // ===============================================
  // üìä AUDITORIA E CONTROLE
  // ===============================================

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  createdBy String? // ID do usu√°rio que criou
  updatedBy String? // ID do usu√°rio que atualizou

  // Aprova√ß√µes e valida√ß√µes
  supervisorReview Boolean? // Revis√£o do supervisor
  reviewedById     String? // ID do supervisor que revisou
  reviewedBy       User?     @relation("SupplyReviewedBy", fields: [reviewedById], references: [id])
  reviewedAt       DateTime? // Data/hora da revis√£o
  reviewNotes      String? // Notas da revis√£o

  @@index([companyId])
  @@index([vehicleId])
  @@index([userId])
  @@index([date])
  @@index([deletedAt])
  @@index([createdAt])
  // √çndice para relat√≥rios por ve√≠culo e per√≠odo
  @@index([vehicleId, date])
  // √çndice para busca por quilometragem
  @@index([vehicleId, kmSupply, date])
}

// ===============================================
// üöõ SERVI√áOS MOTORIZADOS
// ===============================================
// Sistema de relat√≥rios de servi√ßos motorizados
// Integrado ao frontend: MotorizedServiceReportPage
// ===============================================

model MotorizedService {
  id String @id @default(cuid())

  // ===============================================
  // üìã DADOS PRINCIPAIS (CONFORME FRONTEND)
  // ===============================================

  // Data do servi√ßo
  talaoNumber Int      @default(autoincrement()) // Formato: "001", "002", etc.
  date        DateTime // Data do servi√ßo

  // Quilometragem
  kmInitial  Int // Km inicial
  kmFinal    Int? // Km final
  kmTraveled Int? // Km percorrido (calculado)

  // Combust√≠vel
  fuel FuelLevel //1, 0.5, 0 Combust√≠vel tanque cheio , meio tanque ou vazio

  // Hor√°rios
  timeInitial String // Hora inicial (HH:MM)
  timeFinal   String? // Hora final (HH:MM)

  // Dados operacionais
  workShift    WorkShift // Turno  
  streetPatrol String? // Rua/Ronda
  // Status do atendimento
  status       ReportStatus @default(PENDING)

  // Ocorr√™ncia
  occurrence        String? // Ocorr√™ncia (ocorr√™ncia, apoio, portaria)
  vehicleInspection String? // Vistoria do ve√≠culo
  userName          String // Nome do motorista
  witnessName       String? // Nome da testemunha
  supervisorName    String? // Nome do supervisor

  // ===============================================
  // üîó RELACIONAMENTOS PRINCIPAIS
  // ===============================================

  // Multi-tenancy
  company   Company @relation("CompanyMotorizedServices", fields: [companyId], references: [id])
  companyId String

  // Ve√≠culo utilizado
  vehicle   Vehicle? @relation("VehicleMotorizedServices", fields: [vehicleId], references: [id])
  vehicleId String?

  // Relacionamento com turno 
  shift   Shift  @relation("ShiftMotorizedServices", fields: [shiftId], references: [id])
  shiftId String

  // Posto onde ocorreu
  post   Post   @relation("PostMotorizedServices", fields: [postId], references: [id])
  postId String

  // Usu√°rio respons√°vel
  user         User    @relation("UserMotorizedServices", fields: [userId], references: [id])
  userId       String // motorista
  supervisor   User?   @relation("SupervisorMotorizedServices", fields: [supervisorId], references: [id])
  supervisorId String? // supervisor

  // ===============================================
  // üìä AUDITORIA E CONTROLE
  // ===============================================

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  createdBy String? // ID do usu√°rio que criou
  updatedBy String? // ID do usu√°rio que atualizou

  // Aprova√ß√µes e valida√ß√µes
  supervisorReview Boolean? // Revis√£o do supervisor
  reviewedById     String? // ID do supervisor que revisou
  reviewedBy       User?     @relation("MotorizedServiceReviewedBy", fields: [reviewedById], references: [id])
  reviewedAt       DateTime? // Data/hora da revis√£o
  reviewNotes      String? // Notas da revis√£o

  // ===============================================
  // üìä √çNDICES PARA PERFORMANCE
  // ===============================================

  @@index([companyId])
  @@index([vehicleId])
  @@index([userId])
  @@index([date])
  @@index([deletedAt])
  @@index([createdAt])
  // √çndice para busca por quilometragem
  @@index([vehicleId, kmInitial, kmFinal])
}

// ===============================================
// ‚úÖ CHECKLISTS DE VE√çCULOS
// ===============================================
// Sistema de verifica√ß√£o de ve√≠culos
// Integrado ao frontend: VehicleChecklistPage
// ===============================================

model DoormanChecklist {
  id String @id @default(cuid())

  talaoNumber        Int      @default(autoincrement()) // Formato: "001", "002", etc.
  // Usu√°rio respons√°vel
  user               User     @relation("UserDoormanChecklists", fields: [userId], references: [id])
  userId             String // motorista 
  userName           String // nome do motorista 
  // Dados do checklist
  date               DateTime @default(now())
  time               String // Hora do checklist
  generalObservation String?

  // Status do atendimento
  status ReportStatus @default(PENDING)

  // Multi-tenancy
  company   Company @relation("CompanyDoormanChecklists", fields: [companyId], references: [id])
  companyId String
  // Relacionamento com turno 
  shift     Shift   @relation("ShiftDoormanChecklists", fields: [shiftId], references: [id])
  shiftId   String
  // Posto onde ocorreu
  post      Post    @relation("PostDoormanChecklists", fields: [postId], references: [id])
  postId    String

  // ========================================
  // ITENS DO CHECKLIST - CAMPOS FIXOS
  // ========================================

  // Port√£o
  portaoFuncionando Boolean @default(false)
  portaoAmassado    Boolean @default(false)
  portaoObservacao  String?

  // Computador
  computadorFuncionando Boolean @default(false)
  computadorAmassado    Boolean @default(false)
  computadorObservacao  String?

  // Sistema de Monitoramento
  sistemaDeMonitoramentoFuncionando Boolean @default(false)
  sistemaDeMonitoramentoAmassado    Boolean @default(false)
  sistemaDeMonitoramentoObservacao  String?
  // ===============================================
  // üìä AUDITORIA E CONTROLE
  // ===============================================

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  createdBy String? // ID do usu√°rio que criou
  updatedBy String? // ID do usu√°rio que atualizou

  // Aprova√ß√µes e valida√ß√µes
  supervisorReview Boolean? // Revis√£o do supervisor
  reviewedById     String? // ID do supervisor que revisou
  reviewedBy       User?     @relation("DoormanChecklistReviewedBy", fields: [reviewedById], references: [id])
  reviewedAt       DateTime? // Data/hora da revis√£o
  reviewNotes      String? // Notas da revis√£o  

  // ========================================
  // √çNDICES PARA PERFORMANCE
  // ========================================
  // √çndices para consultas r√°pidas 
  @@index([date])
  @@index([createdAt])
}

// ===============================================
// üìã LOGS DE EVENTOS
// ===============================================
// Sistema de auditoria e logs de eventos
// Mantendo compatibilidade com sistema existente
// ===============================================

model EventLog {
  id String @id @default(cuid())

  // ===============================================
  // üìã DADOS PRINCIPAIS
  // ===============================================

  // Tipo de evento
  type String // PANIC, NOTE, PHOTO, SHIFT_START, SHIFT_END, ROUND_START, etc.

  // Detalhes do evento
  details String? // Descri√ß√£o detalhada

  // M√≠dia associada
  media String? // Caminho para arquivo de m√≠dia

  // ===============================================
  // üîó RELACIONAMENTOS
  // ===============================================

  // Multi-tenancy
  company   Company @relation("CompanyEventLogs", fields: [companyId], references: [id])
  companyId String

  // Posto onde ocorreu
  post   Post   @relation("PostEventLogs", fields: [postId], references: [id])
  postId String

  // Usu√°rio respons√°vel (opcional)
  user   User?   @relation("UserEventLogs", fields: [userId], references: [id])
  userId String?

  // ===============================================
  // üìä DADOS ADICIONAIS
  // ===============================================

  // Localiza√ß√£o GPS
  latitude  Float? // Coordenada GPS
  longitude Float? // Coordenada GPS

  // Metadados
  metadata Json? // Dados adicionais em JSON

  // Severidade do evento
  severity String? // LOW, MEDIUM, HIGH, CRITICAL

  // Status do evento
  status String @default("ACTIVE") // ACTIVE, RESOLVED, ARCHIVED

  // ===============================================
  // üìä AUDITORIA
  // ===============================================

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ===============================================
  // üìä √çNDICES
  // ===============================================

  @@index([companyId])
  @@index([postId])
  @@index([userId])
  @@index([type])
  @@index([status])
  @@index([severity])
  @@index([createdAt])
}

// ===============================================
// üö® EVENTOS DE P√ÇNICO
// ===============================================
// Sistema de bot√£o de p√¢nico para moradores
// Mantendo compatibilidade com sistema existente
// ===============================================

model PanicEvent {
  id String @id @default(cuid())

  // ===============================================
  // üìã DADOS PRINCIPAIS
  // ===============================================

  // Data e hora do evento
  dateTime DateTime @default(now())

  // Status do atendimento
  status String // OPEN, ATTENDED, RESOLVED

  // ===============================================
  // üîó RELACIONAMENTOS
  // ===============================================

  // Morador que acionou o p√¢nico
  resident   User   @relation("UserPanicEvents", fields: [residentId], references: [id])
  residentId String

  // Posto relacionado
  post   Post   @relation("PostPanicEvents", fields: [postId], references: [id])
  postId String

  // Multi-tenancy
  company   Company @relation("CompanyPanicEvents", fields: [companyId], references: [id])
  companyId String

  // ===============================================
  // üìä DADOS ADICIONAIS
  // ===============================================

  // Localiza√ß√£o GPS do evento
  latitude  Float? // Coordenada GPS
  longitude Float? // Coordenada GPS

  // Detalhes do evento
  description String? // Descri√ß√£o do evento
  notes       String? // Observa√ß√µes

  // Atendimento
  attendedBy String? // ID de quem atendeu
  attendedAt DateTime? // Quando foi atendido

  // Resolu√ß√£o
  resolvedBy String? // ID de quem resolveu
  resolvedAt DateTime? // Quando foi resolvido
  resolution String? // Descri√ß√£o da resolu√ß√£o

  // ===============================================
  // üìä AUDITORIA
  // ===============================================

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ===============================================
  // üìä √çNDICES
  // ===============================================

  @@index([companyId])
  @@index([residentId])
  @@index([postId])
  @@index([status])
  @@index([dateTime])
  @@index([createdAt])
}

// ===============================================
// üìÅ ARMAZENAMENTO DE ARQUIVOS
// ===============================================
// Sistema de armazenamento de arquivos com MinIO
// Suporte a m√∫ltiplos tipos de arquivo
// ===============================================

enum FileType {
  PROFILE_IMAGE // Imagem de perfil
  DOCUMENT // Documentos (PDF, DOC, etc.)
  REPORT // Relat√≥rios
  VIDEO // V√≠deos
  AUDIO // √Åudios
  OTHER // Outros tipos
}

model File {
  id String @id @default(cuid())

  // ===============================================
  // üìã DADOS DO ARQUIVO
  // ===============================================

  // Nome original do arquivo
  originalName String

  // Nome do arquivo no storage (MinIO)
  fileName String @unique

  // Tipo do arquivo
  type FileType

  // Tamanho em bytes
  size Int

  // MIME type
  mimeType String

  // URL p√∫blica do arquivo
  url String @unique

  // Descri√ß√£o opcional
  description String?

  // ===============================================
  // üîó RELACIONAMENTOS
  // ===============================================

  // Multi-tenancy
  company   Company? @relation("CompanyFiles", fields: [companyId], references: [id])
  companyId String?

  // Usu√°rio que fez upload
  uploadedByUser User?   @relation("UserFiles", fields: [uploadedBy], references: [id])
  uploadedBy     String?

  // ===============================================
  // üìä AUDITORIA
  // ===============================================

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime? // Soft delete

  // ===============================================
  // üìä √çNDICES
  // ===============================================

  @@index([companyId])
  @@index([uploadedBy])
  @@index([type])
  @@index([fileName])
  @@index([url])
  @@index([createdAt])
  @@index([deletedAt])
}
