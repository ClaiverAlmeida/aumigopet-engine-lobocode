// ===============================================
// üéØ PRISMA SCHEMA - AUMIGOPET APP
// ===============================================
// Schema para aplicativo de gest√£o de pets
// Sistema multi-tenant simplificado
// ===============================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ===============================================
// üéØ ENUMS CENTRALIZADOS
// ===============================================

// ===============================================
// üë• USU√ÅRIOS
// ===============================================

enum Roles {
  USER // Usu√°rio comum do app
  ADMIN // Administrador do sistema
  SYSTEM_ADMIN // Super administrador do sistema
  SERVICE_PROVIDER // Prestador de servi√ßo (veterin√°rio, pet shop, etc)
}

enum UserStatus {
  ACTIVE // Ativo
  INACTIVE // Inativo
  SUSPENDED // Suspenso
}

// ===============================================
// üêæ PETS
// ===============================================

enum PetSpecies {
  DOG // Cachorro
  CAT // Gato
  BIRD // P√°ssaro
  FISH // Peixe
  RABBIT // Coelho
  HAMSTER // Hamster
  OTHER // Outro
}

enum PetGender {
  MALE // Macho
  FEMALE // F√™mea
  UNKNOWN // N√£o identificado
}

// ===============================================
// üíâ VACINAS E EXAMES
// ===============================================

enum VaccineExamType {
  VACCINE // Vacina
  EXAM // Exame
}

enum VaccineExamStatus {
  UP_TO_DATE // Em dia
  DUE_SOON // Vencendo em breve
  OVERDUE // Atrasado
  SCHEDULED // Agendado
}

// ===============================================
// üîî LEMBRETES
// ===============================================

enum ReminderType {
  MEDICATION // Medica√ß√£o
  APPOINTMENT // Consulta
  GROOMING // Banho e tosa
  DEWORMING // Vermifuga√ß√£o
  VACCINE // Vacina
  EXAM // Exame
  OTHER // Outro
}

enum ReminderStatus {
  PENDING // Pendente
  COMPLETED // Conclu√≠do
  OVERDUE // Atrasado
  CANCELLED // Cancelado
}

enum SharedTutorStatus {
  PENDING   // Convite enviado, aguardando aceita√ß√£o
  ACCEPTED  // Convite aceito, tutor ativo
  DECLINED  // Convite recusado
  REMOVED   // Tutor removido pelo dono
}

// ===============================================
// üìä PESO
// ===============================================

enum WeightStatus {
  UNDERWEIGHT // Abaixo do peso
  NORMAL // Peso normal
  OVERWEIGHT // Acima do peso
  OBESE // Obeso
}

// ===============================================
// üì± REDE SOCIAL
// ===============================================

enum PostType {
  NORMAL // Post normal
  ADOPTION // Ado√ß√£o
  MISSING // Pet perdido
  SPONSORED // Patrocinado
}

enum PostStatus {
  ACTIVE // Ativo
  INACTIVE // Inativo
  RESOLVED // Resolvido (para ado√ß√£o/perdido)
}

// ===============================================
// üè¢ SERVI√áOS
// ===============================================

enum ServiceCategory {
  VETERINARY // Veterin√°ria
  PET_SHOP // Pet shop
  GROOMING // Banho e tosa
  TRAINING // Adestramento
  HOTEL // Hotel para pets
  DAY_CARE // Creche/day care
  WALKER // Passeador
  OTHER // Outro
}

enum ServiceProviderStatus {
  PENDING // Pendente de aprova√ß√£o
  ACTIVE // Ativo
  INACTIVE // Inativo
  SUSPENDED // Suspenso
}

// ===============================================
// üìÅ ARQUIVOS
// ===============================================

enum FileType {
  PROFILE_IMAGE // Imagem de perfil
  PET_IMAGE // Foto de pet
  POST_IMAGE // Imagem de post
  POST_VIDEO // V√≠deo de post
  DOCUMENT // Documento
  OTHER // Outro
}

// ===============================================
// üè¢ EMPRESAS (MULTI-TENANCY SIMPLIFICADO)
// ===============================================

model Company {
  id           String  @id @default(cuid())
  name         String
  cnpj         String? @unique
  website      String?
  contactEmail String?
  contactPhone String?

  // Relacionamentos
  users         User[]
  notifications Notification[]

  // Auditoria
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@index([cnpj])
  @@index([deletedAt])
}

// ===============================================
// üë• USU√ÅRIOS
// ===============================================

model User {
  id             String     @id @default(cuid())
  name           String
  email          String     @unique
  password       String
  role           Roles   @default(USER)
  status         UserStatus @default(ACTIVE)
  profilePicture String?
  phone          String?
  cpf            String?    @unique
  birthDate      DateTime?
  address        String?
  city           String?
  state          String?
  zipCode        String? 

  // Multi-tenancy (opcional para usu√°rios comuns)
  company   Company? @relation(fields: [companyId], references: [id])
  companyId String?

  // Relacionamentos
  pets              Pet[]
  posts             SocialPost[]
  comments          PostComment[]
  likes             PostLike[]
  following         Follow[]                @relation("UserFollowing")
  followers         Follow[]                @relation("UserFollowers")
  favorites         Favorite[]
  reviews           Review[]
  notifications     NotificationRecipient[]
  files             File[]                  @relation("UserFiles")
  serviceProviders  ServiceProvider[]
  petFriendRequests PetFriendRequest[]      @relation("UserFriendRequests")
  petFriendsFrom    PetFriendship[]         @relation("UserPetFriendsFrom")
  petFriendsTo      PetFriendship[]         @relation("UserPetFriendsTo")
  ownedSharedTutors SharedTutor[]            @relation("OwnerSharedTutors")
  sharedTutors      SharedTutor[]            @relation("SharedUserTutors")

  // Auditoria
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@index([email])
  @@index([cpf])
  @@index([status])
  @@index([role])
  @@index([companyId])
  @@index([deletedAt])
}

// ===============================================
// üêæ PETS
// ===============================================

model Pet {
  id        String     @id @default(cuid())
  name      String
  species   PetSpecies
  breed     String?
  gender    PetGender  @default(UNKNOWN)
  birthDate DateTime?
  weight    Float? // Peso atual em kg
  color     String?
  microchip String?    @unique
  avatar    String?
  notes     String?    @db.Text
  isActive  Boolean    @default(true)

  // Peso ideal (para c√°lculos de sa√∫de)
  idealWeightMin Float? // Peso ideal m√≠nimo em kg
  idealWeightMax Float? // Peso ideal m√°ximo em kg

  // Dono do pet
  owner   User   @relation(fields: [ownerId], references: [id])
  ownerId String

  // Relacionamentos
  vaccinesExams   VaccineExam[]
  reminders       Reminder[]
  weightRecords   WeightRecord[]
  socialPosts     SocialPost[]
  sharedTutors    SharedTutorPet[]
  friendRequests  PetFriendRequest[] @relation("PetFriendRequests")
  friendshipsFrom PetFriendship[]    @relation("PetFriendshipsFrom")
  friendshipsTo   PetFriendship[]    @relation("PetFriendshipsTo")

  // Auditoria
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@index([ownerId])
  @@index([species])
  @@index([microchip])
  @@index([isActive])
  @@index([deletedAt])
}
// ===============================================
// üíâ VACINAS E EXAMES
// ===============================================

model VaccineExam {
  id       String            @id @default(cuid())
  type     VaccineExamType
  name     String
  date     DateTime
  nextDate DateTime? // Pr√≥xima aplica√ß√£o/exame
  reminderDate DateTime? // Data do lembrete configurada pelo app
  location String?
  status   VaccineExamStatus @default(SCHEDULED)
  notes    String?           @db.Text
  document String? // URL do documento/resultado

  // Pet relacionado
  pet   Pet    @relation(fields: [petId], references: [id], onDelete: Cascade)
  petId String

  // Auditoria
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@index([petId])
  @@index([type])
  @@index([status])
  @@index([date])
  @@index([nextDate])
  @@index([deletedAt])
}

// ===============================================
// üîî LEMBRETES
// ===============================================

model Reminder {
  id          String         @id @default(cuid())
  type        ReminderType
  title       String
  description String?        @db.Text
  date        DateTime
  time        String // HH:MM
  status      ReminderStatus @default(PENDING)
  notes       String?        @db.Text

  // Campos espec√≠ficos para medica√ß√£o
  medicationDays Int? // Dura√ß√£o do tratamento em dias
  currentDay     Int?    @default(1) // Dia atual do tratamento
  dosage         String? // Dosagem
  frequency      String? // Frequ√™ncia (ex: "8/8h", "2x ao dia")

  // Campos de recorr√™ncia
  recurring     Boolean  @default(false) // Se o lembrete se repete
  recurringType String?  // Tipo de recorr√™ncia: daily, weekly, monthly

  // Pet relacionado
  pet   Pet    @relation(fields: [petId], references: [id], onDelete: Cascade)
  petId String

  // Auditoria
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@index([petId])
  @@index([type])
  @@index([status])
  @@index([date])
  @@index([deletedAt])
}

// ===============================================
// üìä REGISTROS DE PESO
// ===============================================

model WeightRecord {
  id     String       @id @default(cuid())
  weight Float // Peso em kg
  date   DateTime     @default(now())
  status WeightStatus @default(NORMAL)
  notes  String?      @db.Text

  // Pet relacionado
  pet   Pet    @relation(fields: [petId], references: [id], onDelete: Cascade)
  petId String

  // Auditoria
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@index([petId])
  @@index([date])
  @@index([status])
  @@index([deletedAt])
}

// ===============================================
// üì± REDE SOCIAL - POSTS
// ===============================================

model SocialPost {
  id          String     @id @default(cuid())
  type        PostType   @default(NORMAL)
  content     String     @db.Text
  media       String[] // URLs de fotos/v√≠deos
  status      PostStatus @default(ACTIVE)
  visibility  String     @default("PUBLIC") // PUBLIC, FRIENDS, PRIVATE
  location    String? // Localiza√ß√£o (cidade/estado)
  contactInfo String? // Informa√ß√£o de contato (para ado√ß√£o/perdido)

  // Campos espec√≠ficos para ado√ß√£o
  adoptionBreed  String?
  adoptionAge    String?
  adoptionGender String?

  // Campos espec√≠ficos para perdido
  missingLastSeen  String? // √öltima vez visto
  missingReward    String? // Recompensa
  missingBreed     String?
  missingColor     String?
  missingLatitude  Float?
  missingLongitude Float?

  // Campos para posts patrocinados
  sponsoredLink String?
  sponsoredCta  String? // Call to action

  // Autor do post
  author   User   @relation(fields: [authorId], references: [id])
  authorId String

  // Pet relacionado (se houver)
  pet   Pet?    @relation(fields: [petId], references: [id])
  petId String?

  // Relacionamentos
  comments PostComment[]
  likes    PostLike[]

  // Auditoria
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@index([authorId])
  @@index([petId])
  @@index([type])
  @@index([status])
  @@index([createdAt])
  @@index([deletedAt])
}

// ===============================================
// üí¨ COMENT√ÅRIOS EM POSTS
// ===============================================

model PostComment {
  id      String @id @default(cuid())
  content String @db.Text

  // Post relacionado
  post   SocialPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  postId String

  // Autor do coment√°rio
  author   User   @relation(fields: [authorId], references: [id])
  authorId String

  // Auditoria
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@index([postId])
  @@index([authorId])
  @@index([createdAt])
  @@index([deletedAt])
}

// ===============================================
// ‚ù§Ô∏è CURTIDAS EM POSTS
// ===============================================

model PostLike {
  id String @id @default(cuid())

  // Post relacionado
  post   SocialPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  postId String

  // Usu√°rio que curtiu
  user   User   @relation(fields: [userId], references: [id])
  userId String

  // Auditoria
  createdAt DateTime @default(now())

  @@unique([postId, userId])
  @@index([postId])
  @@index([userId])
}

// ===============================================
// üë• SEGUIR USU√ÅRIOS
// ===============================================

model Follow {
  id String @id @default(cuid())

  // Usu√°rio que segue
  follower   User   @relation("UserFollowing", fields: [followerId], references: [id])
  followerId String

  // Usu√°rio seguido
  following   User   @relation("UserFollowers", fields: [followingId], references: [id])
  followingId String

  // Auditoria
  createdAt DateTime @default(now())

  @@unique([followerId, followingId])
  @@index([followerId])
  @@index([followingId])
}

// ===============================================
// üêï AMIZADES ENTRE PETS - SOLICITA√á√ïES
// ===============================================

model PetFriendRequest {
  id     String  @id @default(cuid())
  status String  @default("PENDING") // PENDING, ACCEPTED, REJECTED
  note   String? @db.Text

  // Usu√°rio que enviou a solicita√ß√£o
  requester   User   @relation("UserFriendRequests", fields: [requesterId], references: [id])
  requesterId String

  // Pet que recebe a solicita√ß√£o
  pet   Pet    @relation("PetFriendRequests", fields: [petId], references: [id], onDelete: Cascade)
  petId String

  // Auditoria
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@unique([requesterId, petId])
  @@index([requesterId])
  @@index([petId])
  @@index([status])
  @@index([deletedAt])
}

// ===============================================
// üêæ AMIZADES ENTRE PETS - CONFIRMADAS
// ===============================================

model PetFriendship {
  id String @id @default(cuid())

  // Usu√°rio que enviou a solicita√ß√£o
  user   User   @relation("UserPetFriendsFrom", fields: [userId], references: [id])
  userId String

  // Pet do usu√°rio
  pet   Pet    @relation("PetFriendshipsFrom", fields: [petId], references: [id], onDelete: Cascade)
  petId String

  // Usu√°rio amigo
  friendUser   User   @relation("UserPetFriendsTo", fields: [friendUserId], references: [id])
  friendUserId String

  // Pet amigo
  friendPet   Pet    @relation("PetFriendshipsTo", fields: [friendPetId], references: [id], onDelete: Cascade)
  friendPetId String

  // Auditoria
  createdAt DateTime  @default(now())
  deletedAt DateTime?

  @@unique([petId, friendPetId])
  @@index([userId])
  @@index([petId])
  @@index([friendUserId])
  @@index([friendPetId])
  @@index([deletedAt])
}

// ===============================================
// üè™ PRESTADORES DE SERVI√áO
// ===============================================

model ServiceProvider {
  id          String                @id @default(cuid())
  name        String
  category    ServiceCategory
  description String?               @db.Text
  logo        String?
  phone       String?
  email       String?
  website     String?
  address     String?
  city        String?
  state       String?
  zipCode     String?
  latitude    Float?
  longitude   Float?
  status      ServiceProviderStatus @default(PENDING)

  // Hor√°rio de funcionamento
  openingHours Json? // { "monday": "08:00-18:00", ... }

  // Dono do servi√ßo (usu√°rio que cadastrou)
  owner   User   @relation(fields: [ownerId], references: [id])
  ownerId String

  // Relacionamentos
  services  Service[]
  reviews   Review[]
  favorites Favorite[]

  // Auditoria
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@index([ownerId])
  @@index([category])
  @@index([status])
  @@index([city])
  @@index([state])
  @@index([deletedAt])
}

// ===============================================
// üõ†Ô∏è SERVI√áOS OFERECIDOS
// ===============================================

model Service {
  id          String  @id @default(cuid())
  name        String
  description String? @db.Text
  price       Float?
  duration    Int? // Dura√ß√£o em minutos
  isActive    Boolean @default(true)

  // Prestador do servi√ßo
  provider   ServiceProvider @relation(fields: [providerId], references: [id], onDelete: Cascade)
  providerId String

  // Auditoria
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@index([providerId])
  @@index([isActive])
  @@index([deletedAt])
}

// ===============================================
// ‚≠ê AVALIA√á√ïES
// ===============================================

model Review {
  id      String  @id @default(cuid())
  rating  Int // 1 a 5 estrelas
  comment String? @db.Text

  // Prestador avaliado
  provider   ServiceProvider @relation(fields: [providerId], references: [id], onDelete: Cascade)
  providerId String

  // Usu√°rio que avaliou
  author   User   @relation(fields: [authorId], references: [id])
  authorId String

  // Auditoria
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@unique([providerId, authorId])
  @@index([providerId])
  @@index([authorId])
  @@index([rating])
  @@index([createdAt])
  @@index([deletedAt])
}

// ===============================================
// ‚≠ê FAVORITOS
// ===============================================

model Favorite {
  id String @id @default(cuid())

  // Prestador favoritado
  provider   ServiceProvider @relation(fields: [providerId], references: [id], onDelete: Cascade)
  providerId String

  // Usu√°rio que favoritou
  user   User   @relation(fields: [userId], references: [id])
  userId String

  // Auditoria
  createdAt DateTime @default(now())

  @@unique([providerId, userId])
  @@index([providerId])
  @@index([userId])
}

// ===============================================
// üìÅ ARMAZENAMENTO DE ARQUIVOS
// ===============================================

model File {
  id           String   @id @default(cuid())
  originalName String
  fileName     String   @unique
  type         FileType
  size         Int
  mimeType     String
  url          String   @unique
  description  String?

  // Usu√°rio que fez upload
  uploadedByUser User?   @relation("UserFiles", fields: [uploadedBy], references: [id])
  uploadedBy     String?

  // Auditoria
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@index([uploadedBy])
  @@index([type])
  @@index([fileName])
  @@index([createdAt])
  @@index([deletedAt])
}

// ===============================================
// üîî SISTEMA DE NOTIFICA√á√ïES
// ===============================================

model Notification {
  id         String  @id @default(cuid())
  title      String
  message    String  @db.Text
  entityType String? // Tipo da entidade (post, reminder, pet, etc.)
  entityId   String? // ID da entidade relacionada

  // Multi-tenancy (opcional)
  company   Company? @relation(fields: [companyId], references: [id])
  companyId String?

  // Usu√°rio que criou a a√ß√£o (opcional)
  createdByUserId String?

  // Destinat√°rios da notifica√ß√£o
  recipients NotificationRecipient[]

  // Auditoria
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@index([companyId])
  @@index([entityType])
  @@index([entityId])
  @@index([createdAt])
  @@index([deletedAt])
}

model NotificationRecipient {
  id     String    @id @default(cuid())
  isRead Boolean   @default(false)
  readAt DateTime?

  // Notifica√ß√£o
  notification   Notification @relation(fields: [notificationId], references: [id], onDelete: Cascade)
  notificationId String

  // Usu√°rio destinat√°rio
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String

  // Auditoria
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([notificationId, userId])
  @@index([userId])
  @@index([notificationId])
  @@index([isRead])
}

// ===============================================
// üë• TUTORES COMPARTILHADOS
// ===============================================

model SharedTutor {
  id          String            @id @default(cuid())
  
  // Relacionamentos
  owner       User              @relation("OwnerSharedTutors", fields: [ownerId], references: [id], onDelete: Cascade)
  ownerId     String
  
  sharedUser  User?             @relation("SharedUserTutors", fields: [sharedUserId], references: [id], onDelete: Cascade)
  sharedUserId String?
  
  // Dados do convite (quando ainda n√£o aceito)
  inviteEmail String?           // Email do convite pendente
  
  // Status e permiss√µes
  status      SharedTutorStatus @default(PENDING)
  permissions Json              // { canEdit: boolean, canViewMedical: boolean, canSchedule: boolean }

  // Pets compartilhados
  pets        SharedTutorPet[]
  
  // Auditoria
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  deletedAt   DateTime?
  
  @@index([ownerId])
  @@index([sharedUserId])
  @@index([status])
  @@index([deletedAt])
}

model SharedTutorPet {
  id            String        @id @default(cuid())
  sharedTutor   SharedTutor   @relation(fields: [sharedTutorId], references: [id], onDelete: Cascade)
  sharedTutorId String
  pet           Pet           @relation(fields: [petId], references: [id], onDelete: Cascade)
  petId         String

  createdAt     DateTime      @default(now())
  deletedAt     DateTime?

  @@unique([sharedTutorId, petId])
  @@index([petId])
  @@index([sharedTutorId])
  @@index([deletedAt])
}
